{% extends "admin_base.html" %}
{% load static %}
{% block content %}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>

<style>
/* ================= BASE ================= */
*{
    box-sizing:border-box;
    margin:0;
    padding:0;
    font-family:'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
}

body{
    background:linear-gradient(135deg,#f8fafc,#f1f5f9);
    color:#0f172a;
    min-height:100vh;
}

/* ================= PAGE ================= */
.page{
    max-width:1400px;
    margin:48px auto;
    padding:0 32px 60px;
}

/* ================= HERO SHOP ================= */
.shop-section{
    background:#ffffff;
    border-radius:32px;
    padding:48px 40px;
    box-shadow:0 25px 50px rgba(15,23,42,0.08);
    margin-bottom:56px;
    text-align:center;
    position:relative;
}

.shop-section::before{
    content:'';
    position:absolute;
    top:0;left:0;right:0;
    height:4px;
    background:linear-gradient(90deg,#0891b2,#0e7490,#0284c7);
}

.shop-title{
    font-size:32px;
    font-weight:700;
    margin-bottom:32px;
    background:linear-gradient(90deg,#0e7490,#0891b2);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
}

/* ================= CATEGORY ICONS ================= */
.shop-categories{
    display:flex;
    justify-content:center;
    gap:32px;
    flex-wrap:wrap;
    margin-bottom:40px;
}

.shop-item{
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:12px;
    padding:10px;
    border-radius:20px;
    transition:.3s;
}

.shop-item:hover{
    transform:translateY(-6px);
    box-shadow:0 12px 24px rgba(8,145,178,.15);
}

.shop-item img{
    width:96px;
    height:96px;
    border-radius:50%;
    object-fit:cover;
    background:#fff;
    border:3px solid #fff;
}

.shop-item span{
    font-size:15px;
    font-weight:600;
}

/* ================= SEARCH ================= */
.big-search{
    max-width:720px;
    margin:auto;
    position:relative;
}

.big-search input{
    width:100%;
    padding:22px 70px 22px 28px;
    border-radius:999px;
    border:2px solid #e2e8f0;
    font-size:16px;
    transition:all 0.3s ease;
}

.big-search input:focus{
    outline:none;
    border-color:#0891b2;
    box-shadow:0 0 0 3px rgba(8,145,178,0.1);
}

.big-search i{
    position:absolute;
    right:28px;
    top:50%;
    transform:translateY(-50%);
    color:#64748b;
}

/* ================= COMBINED WRAPPER ================= */
.subcategory-wrapper{
    border-radius:32px;
    overflow:hidden;
    background:#ffffff;
    box-shadow:0 30px 70px rgba(15,23,42,0.12);
}

/* ================= HEADER ================= */
.page-header{
    background:#0891b2;
    padding:36px 40px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    color:#ffffff;
}

.page-header h1{
    font-size:30px;
    font-weight:700;
    display:flex;
    align-items:center;
    gap:14px;
}

.page-header h1 i{
    font-size:34px;
}

/* ================= ADD BUTTON ================= */
.add-btn{
    background:linear-gradient(135deg,#ffffff,#f8fafc);
    color:#0891b2;
    padding:14px 28px;
    border-radius:18px;
    font-weight:700;
    display:flex;
    align-items:center;
    gap:10px;
    text-decoration:none;
    transition:all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    box-shadow:0 8px 20px rgba(8,145,178,0.15);
    position:relative;
    overflow:hidden;
}

.add-btn::before{
    content:'';
    position:absolute;
    top:0;
    left:-100%;
    width:100%;
    height:100%;
    background:linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    transition:0.5s;
}

.add-btn:hover{
    transform:translateY(-4px) scale(1.02);
    box-shadow:0 15px 30px rgba(8,145,178,0.25);
}

.add-btn:hover::before{
    left:100%;
}

/* ================= GRID SECTION ================= */
.grid-section{
    background:#ffffff;
    padding:42px;
}

/* ================= GRID ================= */
.subcategories-grid{
    display:grid;
    grid-template-columns:repeat(4,1fr);
    gap:32px;
}

/* ================= CARD ================= */
.subcategory-card{
    background:#ffffff;
    border-radius:24px;
    overflow:hidden;
    border:1px solid #e2e8f0;
    box-shadow:0 20px 40px rgba(15,23,42,.08);
    display:flex;
    flex-direction:column;
    transition:.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}


/* IMAGE */
.card-image{
    height:200px;
    display:flex;
    align-items:center;
    justify-content:center;
    background:linear-gradient(135deg,#f8fafc,#e2e8f0);
    overflow:hidden;
    position:relative;
}

.card-image::before{
    content:'';
    position:absolute;
    top:0;
    left:0;
    right:0;
    bottom:0;
    background:linear-gradient(45deg, rgba(8,145,178,0.1), transparent);
    opacity:0;
    transition:opacity 0.3s ease;
}

.subcategory-card:hover .card-image::before{
    opacity:1;
}

.card-image img{
    max-width:100%;
    max-height:100%;
    object-fit:contain;
    transition:transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}



/* CONTENT */
.card-content{
    padding:28px;
    display:flex;
    flex-direction:column;
    flex:1;
}

.card-title{
    font-size:20px;
    font-weight:700;
    margin-bottom:8px;
    color:#0f172a;
    position:relative;
    display:inline-block;
}

.card-title::after{
    content:'';
    position:absolute;
    bottom:-4px;
    left:0;
    width:40px;
    height:3px;
    background:linear-gradient(90deg,#0891b2,#0e7490);
    border-radius:2px;
    transition:width 0.3s ease;
}

.subcategory-card:hover .card-title::after{
    width:60px;
}

.card-slug{
    font-size:13px;
    color:#64748b;
    background:#f1f5f9;
    padding:6px 12px;
    border-radius:20px;
    width:fit-content;
    margin-bottom:16px;
    font-family:'Courier New', monospace;
}

.card-meta{
    font-size:14px;
    color:#475569;
    margin-bottom:24px;
    flex:1;
    line-height:1.6;
}

.card-meta strong{
    color:#0f172a;
    font-weight:600;
}

/* ================= BUTTONS - REDESIGNED ================= */
.card-actions{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:16px;
    margin-top:8px;
}

.btn{
    padding:14px 20px;
    border-radius:14px;
    font-weight:600;
    font-size:14px;
    border:none;
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    gap:10px;
    text-decoration:none;
    transition:all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    text-align:center;
    position:relative;
    overflow:hidden;
    letter-spacing:0.3px;
}

.btn::before{
    content:'';
    position:absolute;
    top:50%;
    left:50%;
    width:0;
    height:0;
    border-radius:50%;
    background:rgba(255,255,255,0.2);
    transform:translate(-50%,-50%);
    transition:width 0.6s, height 0.6s;
}

.btn:hover::before{
    width:300px;
    height:300px;
}

.btn i{
    font-size:15px;
    transition:transform 0.3s ease;
}

.btn:hover i{
    transform:scale(1.2);
}

/* Edit Button - Beautiful Gradient */
.btn-edit{
    background:linear-gradient(135deg,#22c55e,#16a34a,#10b981);
    color:#ffffff;
    box-shadow:0 8px 25px rgba(34,197,94,0.3);
    border:2px solid rgba(255,255,255,0.2);
}

.btn-edit:hover{
    transform:translateY(-4px) scale(1.05);
    box-shadow:0 15px 35px rgba(34,197,94,0.4);
    background:linear-gradient(135deg,#16a34a,#10b981,#0d9c6e);
    color:#ffffff;
}

/* Delete Button - Attractive Red */
.btn-delete{
    background:linear-gradient(135deg,#ef4444,#dc2626,#b91c1c);
    color:#ffffff;
    box-shadow:0 8px 25px rgba(239,68,68,0.3);
    border:2px solid rgba(255,255,255,0.2);
}

.btn-delete:hover{
    transform:translateY(-4px) scale(1.05);
    box-shadow:0 15px 35px rgba(239,68,68,0.4);
    background:linear-gradient(135deg,#dc2626,#b91c1c,#991b1b);
    color:#ffffff;
}

/* Button Animation */
@keyframes buttonPulse{
    0%{transform:scale(1);}
    50%{transform:scale(1.05);}
    100%{transform:scale(1);}
}

.btn:active{
    animation:buttonPulse 0.3s ease;
}

/* ================= DELETE MODAL ================= */
.delete-modal{
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(15,23,42,0.85);
    backdrop-filter:blur(8px);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:1000;
    padding:20px;
}

.delete-modal.active{
    display:flex;
}

.delete-box{
    background:#ffffff;
    width:100%;
    max-width:500px;
    border-radius:28px;
    overflow:hidden;
    box-shadow:0 50px 100px rgba(0,0,0,0.3);
    animation:modalSlideIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

@keyframes modalSlideIn{
    from{
        opacity:0;
        transform:translateY(-30px) scale(0.95);
    }
    to{
        opacity:1;
        transform:translateY(0) scale(1);
    }
}

.delete-header{
    background:linear-gradient(135deg,#ef4444,#dc2626,#b91c1c);
    padding:32px;
    color:#ffffff;
    text-align:center;
    position:relative;
    overflow:hidden;
}

.delete-header::before{
    content:'';
    position:absolute;
    top:-50%;
    left:-50%;
    width:200%;
    height:200%;
    background:linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
    transform:rotate(45deg);
    animation:shine 3s infinite linear;
}

@keyframes shine{
    0%{transform:translateX(-100%) translateY(-100%) rotate(45deg);}
    100%{transform:translateX(100%) translateY(100%) rotate(45deg);}
}

.delete-header i{
    font-size:56px;
    margin-bottom:16px;
    position:relative;
    z-index:1;
    animation:pulse 2s infinite ease-in-out;
}

@keyframes pulse{
    0%,100%{transform:scale(1);}
    50%{transform:scale(1.1);}
}

.delete-header h2{
    font-size:26px;
    font-weight:700;
    position:relative;
    z-index:1;
    letter-spacing:0.5px;
}

.delete-content{
    padding:40px 32px;
    text-align:center;
}

.delete-text{
    font-size:17px;
    color:#475569;
    line-height:1.7;
    margin-bottom:40px;
    font-weight:500;
}

.delete-text b{
    color:#0f172a;
    background:linear-gradient(135deg,#ef4444,#dc2626);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    font-weight:700;
}

.delete-actions{
    display:flex;
    gap:20px;
}

.delete-cancel{
    flex:1;
    background:linear-gradient(135deg,#f1f5f9,#e2e8f0);
    color:#475569;
    padding:16px;
    border-radius:14px;
    font-weight:600;
    border:none;
    cursor:pointer;
    transition:all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    display:flex;
    align-items:center;
    justify-content:center;
    gap:10px;
    border:2px solid transparent;
}

.delete-cancel:hover{
    transform:translateY(-4px);
    background:linear-gradient(135deg,#e2e8f0,#cbd5e1);
    color:#0f172a;
    box-shadow:0 10px 25px rgba(148,163,184,0.2);
}

.delete-confirm{
    flex:1;
    background:linear-gradient(135deg,#ef4444,#dc2626,#b91c1c);
    color:#ffffff;
    padding:16px;
    border-radius:14px;
    font-weight:600;
    border:none;
    cursor:pointer;
    transition:all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    display:flex;
    align-items:center;
    justify-content:center;
    gap:10px;
    border:2px solid rgba(255,255,255,0.2);
    position:relative;
    overflow:hidden;
}

.delete-confirm::before{
    content:'';
    position:absolute;
    top:0;
    left:-100%;
    width:100%;
    height:100%;
    background:linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition:0.6s;
}

.delete-confirm:hover::before{
    left:100%;
}

.delete-confirm:hover{
    transform:translateY(-4px);
    box-shadow:0 15px 35px rgba(239,68,68,0.4);
    background:linear-gradient(135deg,#dc2626,#b91c1c,#991b1b);
}

/* ================= RESPONSIVE ================= */
@media(max-width:1200px){
    .subcategories-grid{grid-template-columns:repeat(3,1fr);}
}

@media(max-width:900px){
    .subcategories-grid{grid-template-columns:repeat(2,1fr);}
    .grid-section{padding:32px;}
    .btn{padding:12px 16px;}
}

@media(max-width:768px){
    .page-header{
        flex-direction:column;
        gap:20px;
        text-align:center;
    }
    .shop-item img{
        width:80px;height:80px;
    }
    .delete-actions{
        flex-direction:column;
    }
    .delete-header{padding:24px;}
    .delete-content{padding:32px 24px;}
}

@media(max-width:520px){
    .subcategories-grid{grid-template-columns:1fr;}
    .page{padding:0 18px;}
    .shop-section{padding:32px 22px;}
    .grid-section{padding:24px;}
    .card-actions{
        grid-template-columns:1fr;
    }
    .btn{padding:14px 20px;}
}
</style>

<div class="page">

<!-- ===== SHOP HERO ===== -->
<div class="shop-section">
    <div class="shop-title">What are you adding for today?</div>

    <div class="shop-categories">
        <div class="shop-item"><img src="{% static 'images/store.jpeg' %}"><span>Groceries</span></div>
        <div class="shop-item"><img src="{% static 'images/fruits.jpeg' %}"><span>Fruits</span></div>
        <div class="shop-item"><img src="{% static 'images/vegeatables.jpeg' %}"><span>Vegetables</span></div>
        <div class="shop-item"><img src="{% static 'images/dairy.jpeg' %}"><span>Dairy</span></div>
        <div class="shop-item"><img src="{% static 'images/snacks.jpeg' %}"><span>Snacks</span></div>
        <div class="shop-item"><img src="{% static 'images/snacks.jpeg' %}"><span>Snacks</span></div>
    </div>

    <div class="big-search">
        <input type="text" id="searchInput" placeholder="Search subcategories, category, store...">
        <i class="fa-solid fa-magnifying-glass"></i>
    </div>
</div>

<!-- ===== DELETE CONFIRMATION MODAL ===== -->
<div class="delete-modal" id="deleteModal">
    <div class="delete-box">
        <div class="delete-header">
            <i class="fa-solid fa-triangle-exclamation"></i>
            <h2>Confirm Delete</h2>
        </div>
        <div class="delete-content">
            <p class="delete-text" id="deleteText">
                Are you sure you want to delete this subcategory? This action cannot be undone.
            </p>
            <div class="delete-actions">
                <button type="button" class="delete-cancel" onclick="closeDeleteModal()">
                    <i class="fa-solid fa-xmark"></i> Cancel
                </button>
                <form method="post" id="deleteForm" style="display: contents;">
                    {% csrf_token %}
                    <button type="submit" class="delete-confirm">
                        <i class="fa-solid fa-trash"></i> Delete
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- ===== HEADER + GRID WRAPPER ===== -->
<div class="subcategory-wrapper">

    <!-- HEADER -->
    <div class="page-header">
        <h1><i class="fa-solid fa-layer-group"></i> SubCategories</h1>
        <a href="{% url 'subcategory_create' %}" class="add-btn">
            <i class="fa-solid fa-plus"></i> Add SubCategory
        </a>
    </div>

    <!-- GRID -->
    <div class="grid-section">
        <div class="subcategories-grid">

        {% for s in subcategories %}
            <div class="subcategory-card"
                 data-name="{{ s.name|lower }}"
                 data-slug="{{ s.slug|lower }}"
                 data-category="{{ s.category.name|lower }}">

                <div class="card-image">
                    {% if s.image %}
                        <img src="{{ s.image.url }}" alt="{{ s.name }}">
                    {% else %}
        <img src="{% static 'images/noimagecat.png' %}" alt="Default image">
                    {% endif %}
                </div>

                <div class="card-content">
                    <div class="card-title">{{ s.name }}</div>
                    <div class="card-slug">{{ s.slug }}</div>

                    <div class="card-meta">
                        <strong>Category:</strong> {{ s.category.name }}<br>
                        <strong>Store:</strong> {{ s.store.name|default:"Global" }}
                    </div>

                    <div class="card-actions">
                        <a href="{% url 'subcategory_update' s.slug %}" class="btn btn-edit">
                            <i class="fa-solid fa-pen-to-square"></i> Edit
                        </a>
                        <button type="button" class="btn btn-delete" onclick="openDeleteModal('{{ s.slug }}', '{{ s.name }}')">
                            <i class="fa-solid fa-trash-can"></i> Delete
                        </button>
                    </div>
                </div>
            </div>
        {% endfor %}

        </div>
    </div>

</div>

</div>

<script>
// Search functionality
const searchInput = document.getElementById("searchInput");
const cards = document.querySelectorAll(".subcategory-card");

searchInput.addEventListener("keyup", () => {
    const val = searchInput.value.toLowerCase().trim();
    cards.forEach(card => {
        const text = 
            card.dataset.name +
            " " +
            card.dataset.slug +
            " " +
            card.dataset.category;
        
        const shouldShow = text.includes(val);
        card.style.display = shouldShow ? "flex" : "none";
        card.style.opacity = shouldShow ? "1" : "0";
        card.style.pointerEvents = shouldShow ? "all" : "none";
    });
});

// Add input focus animation
searchInput.addEventListener('focus', function() {
    this.style.boxShadow = "0 0 0 3px rgba(8,145,178,0.15)";
    this.style.borderColor = "#0891b2";
    this.style.transform = "scale(1.02)";
});

searchInput.addEventListener('blur', function() {
    this.style.boxShadow = "none";
    this.style.borderColor = "#e2e8f0";
    this.style.transform = "scale(1)";
});

// Delete modal functionality
const deleteModal = document.getElementById("deleteModal");
const deleteForm = document.getElementById("deleteForm");
const deleteText = document.getElementById("deleteText");

function openDeleteModal(slug, name) {
    deleteText.innerHTML = `Are you sure you want to delete <b>"${name}"</b>?<br>This action cannot be undone.`;
    deleteForm.action = `/subcategory/delete/${slug}/`;
    deleteModal.classList.add("active");
    
    // Prevent background scrolling
    document.body.style.overflow = "hidden";
    
    // Add ripple effect to the button that was clicked
    const deleteBtn = document.querySelector(`[onclick="openDeleteModal('${slug}', '${name}')"]`);
    if (deleteBtn) {
        deleteBtn.style.animation = "buttonPulse 0.3s ease";
        setTimeout(() => {
            deleteBtn.style.animation = "";
        }, 300);
    }
}

function closeDeleteModal() {
    deleteModal.classList.remove("active");
    document.body.style.overflow = "auto";
}

// Close modal when clicking outside
deleteModal.addEventListener("click", function(event) {
    if (event.target === deleteModal) {
        closeDeleteModal();
    }
});

// Close modal with Escape key
document.addEventListener("keydown", function(event) {
    if (event.key === "Escape" && deleteModal.classList.contains("active")) {
        closeDeleteModal();
    }
});

// Add hover effects to all buttons
document.querySelectorAll('.btn').forEach(button => {
    button.addEventListener('mouseenter', function() {
        this.style.transform = "translateY(-4px) scale(1.05)";
    });
    
    button.addEventListener('mouseleave', function() {
        this.style.transform = "translateY(0) scale(1)";
    });
});
</script>

{% endblock %}